---
title: BNDY-NET
categories: []
tags: []
---

[https://www.notion.so/BNDY-NET-ed10e958cb724f7db25156b9c34e5ed8](https://www.notion.so/BNDY-NET-ed10e958cb724f7db25156b9c34e5ed8)


I'm code Porter, but I produce codes.


## 💯 Frequently Used

---

[Frontend](2221a3b4-33fe-80fb-9a80-d3f6fb8cd623)

[Backend](2221a3b4-33fe-801c-9a46-c113c7f028e8)

[link_to_page](4e3acbe8-eca4-4ae4-a2ad-4600b4003f9a)



## 🎯 Directory

---

[Guidelines](e4c23177-e2ac-456f-9e32-9c14651c4786)

[Languages](8784f81d-a702-497d-8bd9-e62ec8ed5153)

[Resources](9cb570bc-9c1c-43f9-8803-c94501947fad)

[Tools ](e0233f67-91e6-4f5c-8eeb-cf11ef1f6ad7)

[OS & Apps](cc504886-4081-4682-b45b-b1240afcd169)

 

## 🌟 Tips & Tricks

---




## ☀️ Quick Links

- [https://github.com/bndynet](https://github.com/bndynet)
- [https://www.npmjs.com/search?q=%40bndynet](https://www.npmjs.com/search?q=%40bndynet)
- [https://static.bndy.net/logos.html](https://static.bndy.net/logos.html)
- [https://codepen.io/bndynet](https://codepen.io/bndynet)
- [https://hub.docker.com/search?q=bndynet&type=image](https://hub.docker.com/search?q=bndynet&type=image)
- [https://www.materialpalette.com/icons](https://www.materialpalette.com/icons)
- [https://material.angular.cn/](https://material.angular.cn/)

[DevOps](21e1a3b4-33fe-8014-bed9-f90f28b38df1)


	[Monitoring Tools](21f1a3b4-33fe-804d-b85f-e5fb629c9838)


		[healthchecks](21e1a3b4-33fe-807e-b6f9-e38046ceda75)


			## Running in Docker


			 


			```shell
			docker run -d \
			  --name=hc \
			  -p 8010:8000 \
			  --restart unless-stopped \
			  -e DB=sqlite \
			  -e DB_NAME=/data/hc.sqlite \
			  -e DEBUG=False \
			  -e SITE_ROOT=http://10.224.59.43:8010 \
			  -v ~/healthchecks-data:/data \
			healthchecks
			
			docker exec -it hc /opt/healthchecks/manage.py createsuperuser
			```


		[Uptime Kuma](21f1a3b4-33fe-80b1-b3df-cda80e16a2be)


			## Run in Docker


			```shell
			docker run -d \
				--name uk \
				--restart=unless-stopped \
				-p 8010:3001 \
				-v ~/uptime-kuma-data:/app/data \
				louislam/uptime-kuma:1
			```


	[CI and CD](81b39d7b-3481-431f-ac04-1fe0301f13d7)


		[Jenkins File Examples](bb0efd5e-a63e-4169-9913-260f81ad7219)


			## Parameter Definitions


			Scripted


			```shell
			properties([
			    parameters([
			        string(name: 'USERNAME', defaultValue: 'admin', description: 'Enter your username'),
			        booleanParam(name: 'ENABLE_FEATURE', defaultValue: false, description: 'Enable experimental feature'),
			        choice(name: 'DEPLOY_ENV', choices: 'dev\nqa\nprod', description: 'Choose deployment environment')
			    ])
			])
			
			node {
			    echo "USERNAME: ${params.USERNAME}"
			    echo "ENABLE_FEATURE: ${params.ENABLE_FEATURE}"
			    echo "DEPLOY_ENV: ${params.DEPLOY_ENV}"
			}
			```


			Declarative


			```shell
			pipeline {
			    agent any
			    parameters {
			        string(name: 'VERSION', defaultValue: '1.0.0', description: 'Version to deploy')
			        booleanParam(name: 'CONFIRM', defaultValue: true, description: 'Confirm the deployment')
			        choice(name: 'ENV', choices: ['staging', 'production'], description: 'Environment to deploy to')
			    }
			    stages {
			        stage('Print Params') {
			            steps {
			                echo "Version: ${params.VERSION}"
			                echo "Confirm: ${params.CONFIRM}"
			                echo "Environment: ${params.ENV}"
			            }
			        }
			    }
			}
			```


			## Parameter Usage


			```groovy
			node {
			    print '✋' + params
			    print params.anything_to_undefined     // output: null
			    if (params.MultiLines) {
			        params.MultiLines.split("\\r?\\n").each {
			            if (it.trim()) {
			                echo '✋-->' + it
			            }
			        }
			    }
			    // clean workspace
			    cleanWs()
			    try {
			        docker.image('node:20').inside('--network host') {
			            stage("Source code") {
			                checkout([
			                    $class: 'GitSCM',
			                    branches: [[name: '*/${Git_Branch}']],
			                    userRemoteConfigs: [[
			                        url: 'git@github.com:bndynet/typescript-lib-starter.git',
			                        credentialsId: '${Cred_ID}'
			                    ]],
			                    extensions: [
			                        [$class: 'CloneOption', depth: 1, noTags: false, shallow: true],
			[$class: 'CheckoutOption', timeout: 30]
			                    ]
			                ])
			            }
			            stage('Prepare') {
			                sh """
								echo "================================"
								printenv | sort
								echo "================================"
							"""
			                sh 'npm i'
			            }
			            stage('Build') {
			                withEnv(['my_name=bing']) {
			                    // TODO
			                    sh 'Hi ${my_name}.'
			                }
			            }
			            stage('Test') {
			                if (params.Skip_Test != true) {
			                    echo 'do test'
			                } else {
			                    echo 'Skip test'
			                }
			            }
			            stage('Deploy') {
			                if (params.Skip_Deploy != true) {
			                    // TODO
			                    echo 'do deploy'
			                } else {
			                    echo 'Skip deploy'
			                }
			            }
			            stage('Deploy to production') {
			                def toProdParams
			                def didTimeout = false
			                try {
			                    timeout(time: 15, unit: 'SECONDS') {
			                        // change to a convenient timeout for you
			                        toProdParams = input(
			                            id: 'deployToProd', message: 'Deploy to production?', parameters: [
			                                choice(choices: ['prod-a.com/api', 'prod-b.com/api'], description: 'Backend endpoint to connect', name: 'Backend_Uri'),
			                                booleanParam(defaultValue: false, description: 'Archive this package', name: 'Archive')
			                            ]
			                        )
			                    }
			                } catch (err) {
			                    // timeout reached or input false
			                    // def user = err.getCauses()[0].getUser() // required administrator
			                    //if('SYSTEM' == user.toString()) { // SYSTEM means timeout.
			                    didTimeout = true
			                    //} else {
			                    //toProd = false
			                    //echo "Aborted by: [${user}]"
			                    //}
			                }
			                echo '✋Your choice: ' + toProdParams // null if timeout
			                if (toProdParams) {
			                    echo toProdParams.Backend_Uri
			                }
			                if (didTimeout) {
			                    // do something on timeout
			                    echo "no input was received before timeout"
			                } else if (toProdParams) {
			                    // do something
			                    echo "Deployed to production."
			                } else {
			                    // do something else
			                    echo "Skip deployment to production."
			                }
			            }
			        }
			    } catch (error) {
			        echo """❗Exception thrown: 
			    ${error.class}
			    ${error.message}
			    """
			        // error.printStackTrace() // required administrator
			        currentBuild.result = 'FAILURE'
			    } finally {
			        if (currentBuild.result == 'SUCCESS') {
			            // TODO
			        } else {
			            // TODO
			        }
			        echo currentBuild.result
			    }
			}
			```


			## Docker in Node


			```groovy
			node ('your-server-node-label') {
			    stage('Test') {
			        docker.image('node:7-alpine').withRun() {
			            c -> sh 'node --version'
			        }
			    }
			}
			```


			## Maven and Deploy


			```groovy
			pipeline {
			    agent any
			
			    tools { 
			        maven 'Maven 3.5'
			    }
			
			    environment { 
			        APP_NAME     = 'wf'
			        DEPLOY_TO    = '../../../../websites/demo/'
			        EMAIL_RECIPIENTS = 'zb@bndy.net'
			        HAS_DEPLOYMENT   = 'false'
			    }
			
			    stages {
			        stage('Prepare') {
			            steps {
			                updateGithubStatus("PENDING", "Begin to build");
			                //sh 'printenv'
			                sh 'java -version'
			                sh 'mvn -v'
			                sh 'mkdir -p ../../email-templates/ && \\cp ./jenkins/my-groovy-html.template ../../email-templates/my-groovy-html.template'
			            }
			        }
			        stage('Build') {
			            steps {
			                echo 'Building...'
			                sh 'mvn -B -DskipTests clean package' 
			            }
			        }
			        stage('Test') {
			            steps {
			                echo 'Skip tests'
			            }
			        }
			        stage('Deploy') {
			            when {
			                // following expression is just available for multi-branch project
			                branch 'master'
			            }
			            steps {
			                echo 'Deploying....'
			                sh 'rm -f ${DEPLOY_TO}/${APP_NAME}.war'
			                sh 'rm -Rf $DEPLOY_TO/${APP_NAME}'
			                sh 'mv ./target/wf-*.war ${DEPLOY_TO}/${APP_NAME}.war'
			                script {
			                    HAS_DEPLOYMENT = 'true'
			                }
			            }
			        }
			    }
			    
			    post {
			        success {
			            updateGithubStatus("SUCCESS", "Build complete");
			            sendEmail("SUCCESS");
			        }
			        unstable {
			            updateGithubStatus("UNSTABLE", "Build complete");
			            sendEmail("UNSTABLE");
			        }
			        failure {
			            updateGithubStatus("FAILURE", "Build complete");
			            sendEmail("FAILURE");
			        }
			    }
			}
			
			// get change log to be send over the mail
			@NonCPS
			def getChangeString() {
			    MAX_MSG_LEN = 100
			    def changeString = ""
			
			    echo "Gathering SCM changes"
			    def changeLogSets = currentBuild.changeSets
			    for (int i = 0; i < changeLogSets.size(); i++) {
			        def entries = changeLogSets[i].items
			        for (int j = 0; j < entries.length; j++) {
			            def entry = entries[j]
			            truncated_msg = entry.msg.take(MAX_MSG_LEN)
			            changeString += "<li>${truncated_msg} [${entry.author}]</li>"
			        }
			    }
			
			    if (!changeString) {
			        changeString = "<li>No new changes</li>"
			    }
			    return changeString
			}
			
			def sendEmail(status) {
			    def subject = "[" + status + "] ${currentBuild.fullDisplayName}"
			    if (HAS_DEPLOYMENT == 'true') {
			        subject += " - deployed"
			    }
			
			    // Default Email Notification Plugin: email(...), but below supports html
			        emailext(
				mimeType: "text/html",
			        to: "$EMAIL_RECIPIENTS",
			        subject: "${subject}",
				body: '''${SCRIPT, template="my-groovy-html.template"}''',
			        //body: "Changes:<ul>" + getChangeString() + "</ul><br />Check console output at: ${BUILD_URL}console" + "<br />",
				recipientProviders: [[$class: 'CulpritsRecipientProvider'], [$class: 'RequesterRecipientProvider']]
			    )
			}
			
			// set GitHub status
			def getRepoURL() {
			    sh "git config --get remote.origin.url > .git/remote-url"
			    return readFile(".git/remote-url").trim()
			}
			
			def getCommitSha() {
			    sh "git rev-parse HEAD > .git/current-commit"
			    return readFile(".git/current-commit").trim()
			}
			
			def updateGithubStatus(status, message) {
			    // status: pending, success, failure or error
			    repoUrl = getRepoURL()
			    commitSha = getCommitSha()
			
			    step ([
			        $class: 'GitHubCommitStatusSetter',
			        reposSource: [$class: "ManuallyEnteredRepositorySource", url: repoUrl],
			        commitShaSource: [$class: "ManuallyEnteredShaSource", sha: commitSha],
			        errorHandlers: [[$class: 'ShallowAnyErrorHandler']],
			        statusResultSource: [
			            $class: 'ConditionalStatusResultSource',
			            results: [
			                [$class: 'AnyBuildResult', state: status, message: message]
			            ]
			        ]
			    ])
			}
			```


		[Docker Usage](c50b9e8c-c6ad-4889-9e2c-0ff488f271f0)


			```shell
			docker build -t <image-name> --build-arg YOUR_ARG="<arg-value>" .
			
			# -d: as deamon
			# --rm: exit and remove
			docker run -d -p 80:80 -p 443:443 --name <container-name> -v /opt/websites/app:/usr/share/nginx/html <image-name>
			
			# enter the terminal
			docker exec -it <container-name> /bin/bash
			
			docker image remove <image-name>
			
			docker container rm <container-name>
			
			
			##
			docker container rename <container-name> <new-container-name>
			docker rm -f <container-name>
			
			# build from github
			docker build -t <image-name> https://github.com/bndynet/docker.nginx.git[#<branch/tag>:<dir-for-context>]
			
			
			# Copy & Move 
			## Export and import containers
			docker export container-name | gzip > container-name.gz
			zcat container-name.gz | docker import - container-name
			## Container image migration - Using this method, the data volumes will not be migrated, but it preserves the data of the application created inside the container.
			docker commit container-id image-name
			## Save and load images
			docker save image-name > image-name.tar
			cat image-name.tar | docker load
			## copy files from container into host which does not need a running container
			docker cp your-file-path-in-container your-host-location
			
			# Publish
			docker build -t bndynet/image-name:1.0 .
			docker push bndynet/image-name:1.0
			```


			## Networking


			[bookmark](https://docs.docker.com/network/)


			```shell
			# bridge: The default network driver
			# host: use the host’s networking directly
			docker --network bridge|host|overlay|ipvlan
			```


			## Change the port for the existing container


			You can change the port mapping by directly editing the `hostconfig.json` file at `/var/lib/docker/containers/[hash_of_the_container]/hostconfig.json` or `/var/snap/docker/common/var-lib-docker/containers/[hash_of_the_container]/hostconfig.json`, I believe, if You installed Docker as a snap.


			You can determine the [hash_of_the_container] via the `docker inspect <container_name>` command and the value of the "Id" field is the hash.

			1. Stop the container (`docker stop <container_name>`).
			2. Stop docker service (per Tacsiazuma's comment)
			3. Change the file.
			4. Restart your docker engine (to flush/clear config caches).
			5. Start the container (`docker start <container_name>`).

			## Clear


			```shell
				docker system df   # show disk space about docker
				docker image prune -f # clear all images which is not used
			```


			## Print Logs


			```shell
			# print the log for container
			docker logs -f <container-name> 1>/dev/null
			```


			## Example:


			```shell
			IMAGE_NAME = "bndynet/nginx"
			CONTAINER_NAME = "web"
			
			docker rm -f $CONTAINER_NAME || true
			docker image rm $IMAGE_NAME || true
			docker build -t $IMAGE_NAME .
			
			docker run -d -p 80:80 -p 443:443 --name $CONTAINER_NAME -v /opt/website:/usr/share/nginx/html -v /etc/ssl:/etc/ssl $IMAGE_NAME
			```


			## Mirrors


			```json
			{
			  "registry-mirrors": [
			    "https://registry.docker-cn.com",
			    "http://hub-mirror.c.163.com",
			    "https://docker.mirrors.ustc.edu.cn"
			  ]
			}
			```


		[Docker Resource](1c78fd7b-5d8f-411a-8526-bca6a6b67e39)


			# Node.js


			```shell
			docker pull node:14
			docker pull node:<version>-alpine
			docker pull node:<version>-slim
			
			docker run --rm -v "$PWD":/home/node/app -w /home/node/app -it node:14-slim /bin/bash -c "npm build"
			```


		[Docker Q&A](5c764a4b-5ac7-4525-8c16-d83dc576d831)


			## IPv4 forwarding is disabled. Networking will not work


			Solution 1: This won’t work every time


			```shell
			// run on host server
			sysctl -w net.ipv4.ip_forward=1
			sudo systemctl restart network
			```


			Solution 2: Append **net.ipv4.ip_forward=1** to **/etc/sysctl.conf** file.


			Solution 3:  Append parameter **—net=host** to **docker run**, that will use host ports and ignore the **-p** parameters for example:


			```shell
			docker run -it --network host –name mynginx nginx
			```


			## /var/jenkins_home/copy_reference_file.log Permission denied


			> $ docker run -ti -p 8080:8080 -p 50000:50000 -v /opt/jenkins:/var/jenkins_home jenkins touch: cannot touch ‘/var/jenkins_home/copy_reference_file.log’: Permission denied Can not write to /var/jenkins_home/copy_reference_file.log. Wrong volume permissions?


			If you meet the above error, please figure out your volume mapping permissions.


			```javascript
			sudo chown -R 1000:1000 /opt/jenkins
			```


		[Parameters and Variables in Jenkinsfile](c42a2207-b65f-43df-9ff6-f78b2c4e17cb)


			```shell
			import groovy.transform.Field
			
			@Field def globalV = ""
			
			def myFunc() {
			  echo "${globalV}"    // The @Field is required for this variable in definition
			}
			
			node {
				stage('Start') {
					echo 'Testing..'
					print params
					if (params.b) {
						echo 'has b'
					}
					if (b == 'true') {
						echo 'b == true'
					}
					print 's:' + s
					echo 's: ' + s
			      
					if (params.nn) {
						echo 'has nn'
					} else {
						echo 'nn undefined'
					}
				}
			
				stage('Build') {
					echo 'Building..'
				}
			
				stage('Test') {
					echo 'Testing..'
				}
			
				stage('Deploy') {
					echo 'Deploying....'
				}
			
				stage ("Prompt for input") {
					steps {
						script {
							env.USERNAME = input message: 'Please enter the username',
			                             parameters: [string(defaultValue: '',
			                                          description: '',
			                                          name: 'Username')]
							env.PASSWORD = input message: 'Please enter the password',
			                             parameters: [password(defaultValue: '',
			                                          description: '',
			                                          name: 'Password')]
						}
						echo "Username: ${env.USERNAME}"
						echo "Password: ${env.PASSWORD}"
					}
				}
			}
			```


		[Nginx](984ac72f-069c-4bea-a52f-cef4a25f8948)


			## Run in Docker


			```shell
			
			sudo docker pull nginx
			sudo docker run --name my-nginx -p 8080:80 -v /some/content:/usr/share/nginx/html:ro -d nginx
			sudo chmod -R 755 /some/content
			
			```


			## Install Nginx on CentOS 8


			### **1. Update the System**:


			First, update your system to ensure all packages are up to date.


			```shell
			sudo dnf update -y
			```


			### **2. Add the Nginx Repository**


			CentOS 8 doesn't include the latest Nginx packages in its default repositories. To get the latest version, add the official Nginx repository.


			Create a repository file for Nginx:


			```shell
			sudo nano /etc/yum.repos.d/nginx.repo
			```


			Add the following content to the file:


			```text
			[nginx-stable]
			name=nginx stable repo
			baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
			gpgcheck=1
			enabled=1
			gpgkey=https://nginx.org/keys/nginx_signing.key
			
			[nginx-mainline]
			name=nginx mainline repo
			baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
			gpgcheck=1
			enabled=0
			gpgkey=https://nginx.org/keys/nginx_signing.key
			
			```


			The **`nginx-stable`** repository is enabled by default, while the **`nginx-mainline`** repository is not. You can enable the **`nginx-mainline`** repository by setting **`enabled=1`** if you prefer to use the mainline version of Nginx.


			### **3. Install Nginx**:


			Install Nginx using the **`dnf`** package manager.


			```shell
			sudo dnf install nginx -y
			```


			### **4. Start and Enable Nginx**:


			Once the installation is complete, start the Nginx service and enable it to start on boot.


			```shell
			sudo systemctl start nginx
			sudo systemctl enable nginx
			```


			### **5. Verify Nginx Installation**:


			You can verify that Nginx is running by checking its status.


			```shell
			sudo systemctl status nginx
			```


			### **6. Adjust Firewall Settings**:


			If you have a firewall enabled, you'll need to allow traffic on HTTP (port 80) and HTTPS (port 443) ports.


			```shell
			sudo firewall-cmd --permanent --zone=public --add-service=http
			sudo firewall-cmd --permanent --zone=public --add-service=https
			sudo firewall-cmd --reload
			```


			## Configuration for static website based on framework


			```shell
			server {
			    listen 80;
			    server_name yourdomain.com; 
			
			    root /var/www/angular-app; 
			    index index.html;
			    
			    location / {
			        try_files $uri /index.html;
			    }
			
			    error_page 404 /index.html;
			
			    gzip on;
			    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
			}
			```


			## Logs


			```shell
			sudo tail -f /var/log/nginx/error.log
			```


			## Distribute Domains to Ports


			```shell
			server {
			    listen 80;
			    server_name domain1.com;
			 
			    location / {
			        proxy_pass http://localhost:8080;
			        proxy_set_header Host $host;
			        proxy_set_header X-Real-IP $remote_addr;
			        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			    }
			}
			 
			server {
			    listen 80;
			    server_name domain2.com;
			 
			    location / {
			        proxy_pass http://localhost:8081;
			        proxy_set_header Host $host;
			        proxy_set_header X-Real-IP $remote_addr;
			        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			    }
			}
			```


			Use map:


			```shell
			http {
			    map $host $backend {
			        default localhost:80;
			        domain1.com localhost:8080;
			        domain2.com localhost:8081;
			    }
			
			    server {
			        listen 80;
			
			        location / {
			            proxy_pass http://$backend;
			            proxy_set_header Host $host;
			            proxy_set_header X-Real-IP $remote_addr;
			            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			            proxy_set_header X-Forwarded-Proto $scheme;
			        }
			    }
			}
			```


			## **Certificate in Nginx**


			### **1. Obtain an SSL/TLS Certificate**


			You can obtain a certificate from a Certificate Authority (CA) like Let's Encrypt, which provides free SSL/TLS certificates. Using Certbot, you can automate the process of obtaining and renewing certificates


			**Install Certbot:**


			```shell
			sudo dnf install certbot python3-certbot-nginx -y
			```


			**Obtain a Certificate:**
			Replace **`your_domain.com`** with your actual domain name.


			```shell
			sudo certbot --nginx -d your_domain.com
			```


			Follow the prompts to complete the certificate issuance process. Certbot will automatically configure Nginx for SSL.


			### **2. Manually Configuring Nginx with an SSL/TLS Certificate**


			If you have an existing certificate or need to configure it manually, follow these steps:


			**Create a Configuration File for Your Site:**


			```shell
			sudo nano /etc/nginx/conf.d/your_domain.conf
			```


			**Add SSL Configuration:**
			Replace **`your_domain.com`** with your actual domain name and specify the paths to your certificate and key files.


			```text
			server {
			    listen 80;
			    server_name your_domain.com;
			    return 301 https://$host$request_uri;  # Redirect HTTP to HTTPS
			}
			
			server {
			    listen 443 ssl;
			    server_name your_domain.com;
			
			    ssl_certificate /etc/letsencrypt/live/your_domain.com/fullchain.pem;
			    ssl_certificate_key /etc/letsencrypt/live/your_domain.com/privkey.pem;
			
			    ssl_protocols TLSv1.2 TLSv1.3;
			    ssl_prefer_server_ciphers on;
			    ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';
			    ssl_session_cache shared:SSL:10m;
			    ssl_session_timeout 10m;
			
			    location / {
			        proxy_pass http://backend_server;  # Change to your backend application address
			        proxy_set_header Host $host;
			        proxy_set_header X-Real-IP $remote_addr;
			        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			        proxy_set_header X-Forwarded-Proto $scheme;
			    }
			}
			```


			### **3. Configure Firewall**


			Ensure your firewall allows HTTPS traffic:


			```shell
			sudo firewall-cmd --permanent --zone=public --add-service=https
			sudo firewall-cmd --reload
			```


			### **4. Test and Reload Nginx**


			**Test Nginx Configuration:**


			```shell
			sudo nginx -t
			```


			**Reload Nginx to Apply Changes:**


			```shell
			sudo systemctl reload nginx
			```


			## Q&A


			### Error about socket 80


			```shell
			nginx: [emerg] socket() [::]:80 failed (97: Unknown error)
			```


			Nginx try to listen the IPV6 [::]:80. Comment below line from the configuration **/etc/nginx/sites-available/default**.


			```shell
			# listen [::]:80 default_server;
			```


			### Permission denied


			Let **www-data** user have the permission to read the folder.


			```shell
			sudo chown -R www-data:www-data /your/site
			sudo chmod 755 /your/site
			```


			If you still have same error,  maybe your path under some user home folder. You should change the home folder permission.


			```shell
			sudo chown -R username:www-data /home/username
			sudo chmod -R 750 /home/username
			sudo chmod -R 755 /home/username/public_html
			```


		[GitHub Actions ](07bb3aca-648f-407a-91d8-ecbcecdfa59d)


			## Context in Workflow


			More contexts at [https://docs.github.com/en/actions/learn-github-actions/contexts](https://docs.github.com/en/actions/learn-github-actions/contexts)

			- Url for repo, for example: [https://github.com/bndynet/bndynet](https://github.com/bndynet/bndynet)
			`${{ github.server_url }}/${{ github.repository }}`
			- Url for pull request
			`${{ github.server_url }}/${{ github.repository }}/pull/${{ github.event.pull_request.number }}`
			- Url for issue
			`${{ github.server_url }}/${{ github.repository }}/issues/${{ github.event.issue.number }}`

			## About CRON


			```shell
			# ┌───────────── minute (0 - 59)
			# │ ┌───────────── hour (0 - 23)
			# │ │ ┌───────────── day of the month (1 - 31)
			# │ │ │ ┌───────────── month (1 - 12)
			# │ │ │ │ ┌───────────── day of the week (0 - 6)
			# │ │ │ │ │                       
			# │ │ │ │ │
			# │ │ │ │ │
			# * * * * * <command to execute>
			```


			### Examples


			```shell
			name: Test Build
			
			on:  
			  push:
			  pull_request:
			  schedule:
			    - cron: '00 1 * * 1'  # At 01:00 on Mondays.
			```


			```shell
			name: Sync Notion pages to posts
			
			on:
			  schedule:
			    # Runs "At 20:00 on every day-of-week"
			    - cron: '0 20 * * *'
			    
			jobs:
			  # Build job
			  sync:
			    runs-on: ubuntu-latest
			    steps:
			      - name: Checkout
			        uses: actions/checkout@v3
			
			      - name: Generate posts
			        uses: bndynet/github-action-notion@v1
			        with:
			          notion-token: ${{ secrets.NOTION_TOKEN}}
			          root-page-id: ${{ secrets.NOTION_ROOT_PAGE_ID }}
			
			      - name: Commit posts
			        uses: EndBug/add-and-commit@v9  # https://github.com/marketplace/actions/add-commit
			        with:
			          add: '_posts'
			          message: Sync Notion pages to posts by GitHub Actions
			          committer_name: Bendy Zhang
			          committer_email: email@your.com
			```


		[Jenkins](d090c097-d99c-4e19-9fb8-7edad5907c36)


			## Start Jenkins


			### S**tartup script to set the System Properties**


			**Step 1:**

			- Locate the Jenkins home directory. You can look into the existing system properties for ‘jenkins_home’ or execute ‘echo $JENKINS_HOME’ inside the jenkins server to get the Jenkins home directory.
			- Say if your Jenkins home directory is ‘_/var/jenkins_home_’. Create a new directory with name ‘init.groovy.d’.

			**Step 2:**

			- Now change your working directory to ‘_/var/jenkins_home/init.groovy.d_’
			- Within _init.groovy.d_ directory create a new groovy script. Say ‘_startup-properties.groovy’_

			**Step 3:**

			- Copy the below content to the ‘_startup-properties.groovy_’ file

			```groovy
			import jenkins.model.Jenkins
			import java.util.logging.LogManager
			
			/* Jenkins home directory */
			def jenkinsHome = Jenkins.instance.getRootDir().absolutePath
			def logger = LogManager.getLogManager().getLogger("")
			
			/* Replace the Key and value with the values you want to set.*/
			/* System.setProperty(key, value)*/
			System.setProperty("hudson.model.WorkspaceCleanupThread.disabled", "true")
			logger.info("Jenkins Startup Script: Successfully updated the system properties. Script location: ${jenkinsHome}/init.groovy.d")
			```


			Visit [https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/System.html?is-external=true#setProperty(java.lang.String,java.lang.String)](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/System.html?is-external=true#setProperty(java.lang.String,java.lang.String)) to see how to use setProperty.


			**Step 4:**


			Restart the Jenkins server, you can manually restart the server using :


			_<Jenkins-server-URL>/restart_ **or** _<Jenkins-server-URL>/safeRestart_

			- Use safeRestart when you have some job still running. It will wait till all the jobs are completed.

			**Step 5:**


			Check the logs after Jenkins restart: Manage Jenkins → System Log. You can see while server is starting, its executing the startup-properties.groovy script which is inside init.groovy.d directory.


			![](https://miro.medium.com/max/1400/1*kjzZCxTixWCYsQbIcfRkzA.png)


			For example, run the below scripts in Script Console to check the System Properties, you will see the required key and values.


			```groovy
			println(System.getProperty("hudson.model.WorkspaceCleanupThread.disabled"))
			```


			> Now every time server is restarted the script will run and set the system properties for you. You don’t need to worry for setting these system properties manually every time server restart.


			[https://wiki.jenkins-ci.org/display/JENKINS/Features-controlled-by-system-properties.html](https://wiki.jenkins-ci.org/display/JENKINS/Features-controlled-by-system-properties.html)


			### Start  docker container with system properties


			[link_preview](https://github.com/bndynet/docker.jenkins)


			```shell
			docker run --name my-jenkins -p 8080:8080 -p 50000:50000 -v /your/jenkins_home:/var/jenkins_home \
			  -d \
			  -v /var/run/docker.sock:/var/run/docker.sock \
			  --env JAVA_OPTS="-Dhudson.model.WorkspaceCleanupThread.disabled=\"true\"" \
			  --restart unless-stopped \
			  --user root \
			  bndynet/jenkins
			```


			### Plugin: **Configuration as Code (aka.JCasC )**


			Apply configuration from Git


			```shell
			https://<USERNAME>:<PERSON_ACCESS_TOKEN>@github.com/your-repo/jenkins-config.git
			```


			## Add Nodes


			Step 1. In node server, install java by [https://sdkman.io/](https://sdkman.io/)


			```shell
			curl -s "https://get.sdkman.io" | bash
			sdk install java 17.0.14-tem
			```


			Step 2. Add java path for all users (**/etc/environment**)


			```shell
			JAVA_HOME=/home/<user>/.sdkman/candidates/java/current
			PATH="/home/<user>/.sdkman/candidates/java/current/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin"
			```


			Step 3. Generate ssh key in jenkins server, if you are running jenkins on container, you should enter the container to do that.


			```shell
			 **ssh-keygen -t rsa -b 4096 -f /var/jenkins_home/id_rsa**
			```


			Step 4. Copy pub key to node server


			```shell
			ssh-copy-id -i /var/jenkins_home/.ssh/id_rsa.pub username@hostname
			```


			Step 5. Add **Credentials** in jenkins UI with the private key


			Step 6. Add **Node** in jenkins UI with **Launch agens via SSH**, and choose above **Credentials**


			### Q: **Could not copy remoting.jar into '/home/jenkins' on agent**


			If below error thrown:


			**Permission denied (SSH_FX_PERMISSION_DENIED: The user does not have sufficient permissions to perform the operation.)**


		[Useful Scripts for Jenkins](a0fc6caf-2cdc-43c6-a45f-406e816c2d5d)


			## **Decrypt credentials defined in Jenkins and list values.**


			```groovy
			def creds = com.cloudbees.plugins.credentials.CredentialsProvider.lookupCredentials(
			    com.cloudbees.plugins.credentials.common.StandardUsernameCredentials.class,
			    Jenkins.instance,
			    null,
			    null
			);
			for (c in creds) {
			  if (c.properties.privateKeySource) {
				  println("ID: " + c.id)
			    println("UserName: " + c.username)
			    println("Description: " + c.description)
				  println("Private Key: " + c.getPrivateKey() )
			  }
			}
			```


			## **Decrypt the password if you got its HASH.**


			```groovy
			println(hudson.util.Secret.decrypt("{HASHxxxxx=}"))
			# or /////
			println(hudson.util.Secret.fromString("{HASHxxxxx=}").getPlainText())
			```


			## Trigger build by url


			```shell
			# Run when the anonymous user has the build permission
			curl http://127.0.0.1:8080/job/Trigger_Remote_Demo/build?token=My-token
			# Send request with credentials
			curl -u username:api_token http://127.0.0.1:8080/job/Trigger_Remote_Demo/build
			# Build with Parameter
			curl -u username:api_token http://127.0.0.1:8080/job/Trigger_Remote_Demo/buildWithParameters?para1=val1&para2=val2
			```


		[Update Jenkins inside Docker Container](caffb7b2-f92e-4f02-90df-e3cfb1f33def)


			First identify your image.


			`$ docker ps --format "{{.ID}}: {{.Image}} {{.Names}}"3d2fb2ab2ca5: jenkins-docker jenkins-docker_1`


			Then login into the image as root.


			`$ docker container exec -u 0 -it jenkins-docker_1 /bin/bash`


			Now you are inside the container, download the `jenkins.war` file from the official site like.


			`# wget http://updates.jenkins-ci.org/download/war/2.176.1/jenkins.war`


			Replace the version with the one that fits to you.


			The next step is to move that file and replace the oldest one.


			`# mv ./jenkins.war /usr/share/jenkins/`


			Then change permissions.


			`# chown jenkins:jenkins /usr/share/jenkins/jenkins.war`


			The last step is to logout from the container and restart it.


			`$ docker restart jenkins-docker_1`


			You can verify that update was successful by access to you Jenkins url.


		[Podman](6c02911b-97b6-4ff8-b44a-f35eb4019674)


			The alternative of docker as docker is no longer free for enterprise users.


			## **Installation**


			[bookmark](https://podman.io/docs/installation)


			### Install from download


			```shell
			wget https://github.com/containers/podman/releases/latest/download/podman-remote-static-linux_amd64.tar.gz
			tar -xvzf podman-remote-static-linux_amd64.tar.gz
			sudo mv ./bin/podman-remote-static-linux_amd64 /usr/local/bin/podman
			sudo chmod +x /usr/local/bin/podman
			```


			## Examples


			```shell
			# If you want to keep your existing volumns, you should use --userns=keep-id,
			# otherwise, it might throw "operation not permitted" when start a container
			podman run -d --name my-container --userns=keep-id \
			    -v /your-path:/path
				image-name
			```


			## Configure sources


			Open **/etc/containers/registries.conf** and uncomment below line, so that you can pull images from other sources.


			```shell
			unqualified-search-registries = ["registry.fedoraproject.org", "registry.access.redhat.com", "docker.io"]
			```


			## Jenkins in Podman


			### Run podman in jenkins pipeline if jenkins is running in container


			Mount the socket of podman into jenkins container.


			```shell
			docker run -d \
			  --name my-jenkins \
			  -p 8080:8080 \
			  -v /home/<host_user>/jenkins_home:/var/jenkins_home \
			  -v /run/user/1000/podman/podman.sock:/run/user/1000/podman/podman.sock \
			  bndynet/jenkins
			```


			Then run it in pipeline:


			```shell
			pipeline {
			    agent any
			    stages {
			        stage('Run Podman') {
			            steps {
			                sh 'export PODMAN_HOST=unix:///run/user/1000/podman/podman.sock && podman run --rm hello-world'
			            }
			        }
			    }
			}
			
			```


			## Let jenkins account run podman


			```shell
			sudo usermod --add-subuids 100000-165535 --add-subgids 100000-165535 jenkins
			```


			If the jenkins user does not exist, please create one:


			```shell
			sudo useradd -m -s /bin/bash jenkins
			sudo passwd jenkins  # set password（optional）
			```


			Restart jenkins


			```shell
			sudo systemctl restart jenkins
			# or podman restart jenkins-container
			```


			## Automatically Start


			Podman provides generate systemd command, that can generate systemd service file to restart when server starts.


			```shell
			podman generate systemd --name my-container --restart-policy=always > /etc/systemd/system/my-container.service
			
			```


			Then enable and start service:


			```shell
			systemctl daemon-reload
			systemctl enable my-container
			systemctl start my-container
			```


			In this way, **my-container** will start automatically, it likes docker **--restart unless-stopped.**


			## Q&A


			### Can not “podman machine start”?


			You need to remove the current machine via `podman machine rm`. and reinit via `podman machine init`. 


	[link_to_page](083df528-3146-4e92-b81b-aba662265434)

